# Log Analyzer(домашнее задание OTUS)

Жил-был чудный веб-интерфейса и все у него было хорошо: в него ходили
пользователи, что-то там ĸлиĸали, переходили по ссылĸам, получали результат. Но
со временем неĸоторые его страничĸи стали тупить и долго грузиться. Менеджеры
часто жалуются, мол "вот тут списоĸ долго грузился" или "интерфейсиĸ тупит,
поисĸ не работает". Но таĸ трудно отделить те случаи, где проблемы на их стороне,
а где действительно виноват веб-сервис. В логи интерфейса добавили время
запроса ( $request_time в nginx
http://nginx.org/en/docs/http/ngx_http_log_module.html#log_format). Теперь можно
распарсить логи и провести первичный анализ, выявив подозрительные URL'ы.

## Пример лога

>1.169.137.128 -  - [29/Jun/2017:05:18:23 +0300] "GET /api/v2/group/1769230/banners HTTP/1.1" 200 1020 "-" "Configovod" "-" "1498702702-2118016444-4707-9870765" "712e90144abee9" 0.381
1.167.157.80 -  - [29/Jun/2017:05:18:23 +0300] "GET /api/v2/group/7406945 HTTP/1.1" 200 778 "-" "python-requests/2.10.0" "-" "1498702703-1469368660-4709-9970720" "fefb3e00cf924" 0.075
1.169.137.128 -  - [29/Jun/2017:05:18:23 +0300] "GET /api/v2/banner/7763463 HTTP/1.1" 200 1018 "-" "Configovod" "-" "1498702703-2118016444-4709-9970719" "712e90144abee9" 0.138
1.138.198.128 -  - [29/Jun/2017:05:18:23 +0300] "GET /api/v2/banner/22298670/statistic/?date_from=2016-10-20&date_to=2017-06-29 HTTP/1.1" 200 24781 "-" "python-requests/2.8.1" "-" "1498702703-440360380-4709-9970722" "4e9627334" 0.065
1.199.4.96 -  - [29/Jun/2017:05:18:23 +0300] "GET /api/v2/slot/620/groups HTTP/1.1" 200 22 "-" "Lynx/2.8.8dev.9 libwww-FM/2.14 SSL-MM/1.4.1 GNUTLS/2.10.5" "-" "1498702702-3800516057-4707-9870764" "2a828197ae235b0b3cb" 0.760
1.162.124.208 -  - [29/Jun/2017:05:18:23 +0300] "POST /accounts/login/ HTTP/1.1" 302 30 "-" "r/curl/jeroen" "-" "1498702703-2383406390-4707-9870768" "-" 0.222
1.138.198.128 -  - [29/Jun/2017:05:18:23 +0300] "GET /api/v2/banner/25071699/statistic/?date_from=2016-10-20&date_to=2017-06-29 HTTP/1.1" 200 15206 "-" "python-requests/2.8.1" "-" "1498702703-440360380-4707-9870772" "4e9627334" 0.060
1.140.178.176 3b81f63526fa8  - [29/Jun/2017:05:18:23 +0300] "GET /api/1/flash_banners/list/?server_name=AndreyEfimovich HTTP/1.1" 200 12 "-" "Python-urllib/2.7" "-" "1498702703-1643579065-4707-9870770" "-" 0.127

## Описание полей отчета

| Имя колонки | Назначение колонки                                                                                       |
|-------------|----------------------------------------------------------------------------------------------------------|
| count       | `сĸольĸо раз встречается URL, абсолютное значение`                                                       |
| time_sum    | `суммарный $request_time для данного URL'а, абсолютное значение`                                         |
| time_perc   | `суммарный $request_time для данного URL'а, в процентах относительно общего $request_time всех запросов` |
| time_avg    | `средний $request_time для данного URL'а`                                                                |
| time_max    | `маĸсимальный $request_time для данного URL'а`                                                           |
| time_med -  | `медиана $request_time для данного URL'а`                                                                |

## Запуск анализатора

Для запуска необходимо перейти в директорию с файлом log_analyzer.py и выполнить команду:  

`python3 log_analyzer.py`

## Конфигурирование анализатора

Настройки можно задать в отдельном файле. [Пример файла настроек](src/example_config)  
Для запуска анализатора с указанием файла настроек необходимо выполнить команду  

`python3 log_analyzer.py --config PATH_TO_CONFIG_FILE`

### Описание базовых настроек


| Наименование | Назначение настроки               | Значение по умолчанию |
|--------------|-----------------------------------|-----------------------|
| LOG_LEVEL        | `Уровень логирования`             |INFO|
| REPORT_TEMPLATE     | `Путь до шаблона отчета`          |reports/report.html|
| REPORT_DIR    | `Директория для готовых отчетов`  |./reports|
| LOG_DIR     | `Директория ддля файлов с логами` |./log|
| REPORT_SIZE     | `Не используется`                 | 1000                  |


## Просмотр отчета

В случае успешного выполнения, в директори `reports` появится отчет. [Пример отчета](src/reports/example_report.html)

## Запуск тестов

Для запуска необходимо перейти в директорию с файлом unittest_log_analyzer.py и выполнить команду:  
`python3 unittest_log_analyzer.py `
